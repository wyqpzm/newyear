<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width,user-scalable=no" name="viewport"> 
    <title>新年福签</title>
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/screen.css">
    <!-- <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script> -->
</head>
<body>
    <div id="app">

    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.8/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="text/javascript">
    
        var vm = new Vue({
            el: '#app',
            data: {},
            mounted: function(){
                var $_GET = this.getUrlParams();
                axios.post('/info', {
                    code: $_GET['code']
                })
                .then(function (response) {
                    console.log(response);
                })
                .catch(function (error) {
                    console.log(error);
                });
            },
            methods:{
                getUrlParams: function () {
                    var qs=location.search.length>0?location.search.substring(1):"";
                    var items=qs.length>0?qs.split("&"):[];
                    var args={};
                    for(var i in items){
                        var item=items[i].split("=");
                        var name=decodeURIComponent(item[0]);
                        var value=decodeURIComponent(item[1]);
                        args[name]=value;
                    }
                    return args;
                }
            }
        })    
            // getInfo();
            /* function getInfo(){
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/card', true);
                xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");
                xhr.responseType = 'json';
                xhr.onload = function () {
                    if(xhr.status == 200){
                        console.log(xhr.response);
                        window.data = xhr.response;
                        holder.style.backgroundImage = "url('img/"+data.index+"_bg@3x.png')";
                        text.src = "img/"+data.index+"_text.svg";
                        intro.innerHTML = data.name;
                        for(var i = 0;i<data.brief.length;i++){
                            var el = document.createElement("li");
                            el.innerHTML = data.brief[i];
                            holder_ul.appendChild(el);
                        }

                    }else{
                        console.error("The request status not is 200.");
                    }
                }
                xhr.send();
            }; */
            var wxConfig = function(){
                var url = location.href;
                console.log(url);
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/wx', true);
                xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");
                xhr.responseType = 'json';
                xhr.onload = function () {
                    if(xhr.status == 200){
                        console.log(xhr.response);
                        var data = xhr.response;
                        wx.config({
                            debug: true,
                            appId: "wxf2083e95eed07c8a",
                            timestamp: data.timestamp,
                            nonceStr: data.nonceStr,
                            signature: data.signature,
                            jsApiList: ['checkJsApi','onMenuShareTimeline']
                        });
                        wx.ready(function() {
                            wx.checkJsApi({
                                jsApiList: [
                                    'getNetworkType',
                                    'previewImage'
                                ],
                                success: function(res) {
                                    console.log(JSON.stringify(res));
                                }
                            });

                            //分享到朋友圈
                            wx.onMenuShareTimeline({
                                title: '新年福签',
                                desc: '我抽取到中建西南院的新年福签是'+data.title,
                                link: url,
                                imgUrl: 'img/home_fu@3x.png'
                            });

                        });
                    }else{
                        console.error("The request status not is 200.");
                    }
                }
                xhr.send("url="+url);
                    
            };
    </script>
</body>
</html>