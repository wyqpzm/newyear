<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width,user-scalable=no" name="viewport"> 
    <title>新年福签</title>
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/screen.css">
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
</head>
<body>
    <img src="image/icon.png" alt="cswadi" width="0" height="0">
    <!-- <div style="display:none">
         <img class="happy" src="img/home_fu@3x.png">
    </div> -->
    <div id="card" >
        <div id="card_centent">
            <div id="firework">
                <div class="before"></div>
                <div class="after"></div>
            </div>
            <img id="card_text" src="image/tag_2-text.png" style="height: 70%;position: relative;left: 1px;">
            <img id="card_mark" src="image/tag-2019-text.png" style="width: 30px;position: absolute;top: 37%;margin-left: 20px;">
            
            <!-- <ul id="card_ul">
            </ul>
            <p id="card_intro"></p> -->
        </div>
        <div id="card_top"></div>
        <div id="card_bottom">
            <img class="logo" src="image/tag-bg-logo.png">
            <img src="image/tag-bg-bottom.png" style="width: 100%;position: absolute;bottom: 0;left: 0;">
        </div>
    </div>
    <div id="empty"></div>
    <div id="index">
        <div id="logo">
            <img src="image/logo.png" alt="cswadi">
        </div>
        <div id="dec-tree">
            <img src="img/dec-tree.png">
        </div>
        <div id="happy">
            <img class="happy" src="image/index-main-fu.png">
            <!-- <img class="qian" src="img/home_qian@3x.png"> -->
            <div id="text">
                <img class="pointer" src="img/pointer.png">
                <img class="text" src="img/text.png">
            </div>
            <p id="tips">
                <img src="image/logo-sm.png" style="width:90px;">
            </p>
        </div>
        
        <img class="lantern1" src="image/lantern.png">
        <img class="lantern2" src="image/lantern.png">
    </div>
    <script type="text/javascript">
    document.setTitle = function(t) {
        document.title = t;
        var i = document.createElement('iframe');
        i.src = '//m.baidu.com/favicon.ico';
        i.style.display = 'none';
        i.onload = function() {
          setTimeout(function(){
            i.remove();
          }, 9)
        }
        document.body.appendChild(i);
      }
      
        window.onload = function () {
            var btn = document.getElementById("happy");
            var index = document.getElementById("index");
            var empty = document.getElementById("empty");
            var card = document.getElementById("card");
            var text = document.getElementById("card_text");
            var intro = document.getElementById("card_intro");
            var top = document.getElementById("card_top");
            var bottom = document.getElementById("card_bottom");
            var firework = document.getElementById("firework");
            var firework = document.getElementById("firework");
            var cardMark = document.getElementById("card_mark");
            btn.onclick = function () {
                index.style.display = "none";
                empty.style.display = "none";
                // top.className = "slideIndown";
                // text.className = "slideInLeft";
                text.className = "bounceInDown";
                bottom.className = "slideInUp";
                cardMark.className = "fadeIn";
                setTimeout(function(){
                    firework.className = "pyro";
                },300);
                /* var lines = holder.getElementsByTagName("li");
                for(var i =0;i<lines.length;i++){
                    (function(index){
                        console.log(index);
                        setTimeout(function(){
                            var line = lines[index];
                            line.style.display = "block";
                            line.className = "slideInLeft";
                        },500);
                    })(i)
                    
                } */
                document.setTitle("我在中建西南院抽到的福签是："+data.name);
                // wxConfig();
            };
            function getInfo(){
                var list = [{
                index: 1,
                name: "升职加薪"
                },{
                index: 2,
                name: "锦鲤附身"
                },{
                index: 3,
                name: "多吃不胖"
                },{
                index: 4,
                name: "人生赢家"
                },{
                index: 5,
                name: "一稿过"
                },{
                index: 6,
                name: "C位出道"
                },{
                index: 7,
                name: "逆生长"
                },{
                index: 8,
                name: "一路躺赢"
                },{
                index: 9,
                name: "平安喜乐"
                },];
                var random = parseInt(Math.random()*10);
                window.data = list[random];
                console.log(random);
                console.log(data);
                text.src = "image/tag_"+data.index+"-text.png";
            }
            getInfo();
            /* function getInfo(){
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/card', true);
                xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");
                xhr.responseType = 'json';
                xhr.onload = function () {
                    if(xhr.status == 200){
                        console.log(xhr.response);
                        window.data = xhr.response;
                        holder.style.backgroundImage = "url('img/"+data.index+"_bg@3x.png')";
                        text.src = "img/"+data.index+"_text.svg";
                        intro.innerHTML = data.name;
                        for(var i = 0;i<data.brief.length;i++){
                            var el = document.createElement("li");
                            el.innerHTML = data.brief[i];
                            holder_ul.appendChild(el);
                        }

                    }else{
                        console.error("The request status not is 200.");
                    }
                }
                xhr.send();
            }; */
            var wxConfig = function(){
                var url = location.href;
                console.log(url);
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/wx', true);
                xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");
                xhr.responseType = 'json';
                xhr.onload = function () {
                    if(xhr.status == 200){
                        console.log(xhr.response);
                        var data = xhr.response;
                        wx.config({
                            debug: true,
                            appId: "wxf2083e95eed07c8a",
                            timestamp: data.timestamp,
                            nonceStr: data.nonceStr,
                            signature: data.signature,
                            jsApiList: ['checkJsApi','onMenuShareTimeline']
                        });
                        wx.ready(function() {
                            wx.checkJsApi({
                                jsApiList: [
                                    'getNetworkType',
                                    'previewImage'
                                ],
                                success: function(res) {
                                    console.log(JSON.stringify(res));
                                }
                            });

                            //分享到朋友圈
                            wx.onMenuShareTimeline({
                                title: '新年福签',
                                desc: '我抽取到中建西南院的新年福签是'+data.title,
                                link: url,
                                imgUrl: 'img/home_fu@3x.png'
                            });

                        });
                    }else{
                        console.error("The request status not is 200.");
                    }
                }
                xhr.send("url="+url);
                    
            };
        }
    </script>
</body>
</html>